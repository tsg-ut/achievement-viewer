import{r as K,g as f,_ as W}from"./TjpexaZJ.js";import{d as h}from"./DfAzwDaU.js";import{g as U}from"./Cpj98o6Y.js";import{r as X,a as Z,b as $,s as ee}from"./CfvznefP.js";import{A as se,a as re}from"./B3mpm1KF.js";import{z as te,_ as E,x as D,c as m,o as l,a as s,I as _,B as p,t as u,F as y,C as v,d as Y,y as I,A as ne,b as ie}from"./CTB8TFYg.js";import"./CdjJNdvM.js";var x,z;function oe(){if(z)return x;z=1;function t(e){return e&&e.length?e[0]:void 0}return x=t,x}var w,S;function ae(){return S||(S=1,w=oe()),w}var le=ae();const ge=U(le);var A,Q;function ue(){if(Q)return A;Q=1;var t=X();function e(i,g,n){g=="__proto__"&&t?t(i,g,{configurable:!0,enumerable:!0,value:n,writable:!0}):i[g]=n}return A=e,A}var k,j;function ce(){if(j)return k;j=1;function t(e,i,g,n){for(var r=-1,c=e==null?0:e.length;++r<c;){var a=e[r];i(n,a,g(a),e)}return n}return k=t,k}var q,H;function me(){if(H)return q;H=1;var t=Z();function e(i,g,n,r){return t(i,function(c,a,o){g(r,c,n(c),o)}),r}return q=e,q}var P,R;function de(){if(R)return P;R=1;var t=ce(),e=me(),i=$(),g=K();function n(r,c){return function(a,o){var d=g(a)?t:e,b=c?c():{};return d(a,r,i(o,2),b)}}return P=n,P}var T,V;function pe(){if(V)return T;V=1;var t=ue(),e=de(),i=Object.prototype,g=i.hasOwnProperty,n=e(function(r,c,a){g.call(r,a)?r[a].push(c):t(r,a,[c])});return T=n,T}var he=pe();const fe=U(he);var C,G;function _e(){if(G)return C;G=1;function t(e){var i=e==null?0:e.length;return i?e[i-1]:void 0}return C=t,C}var ye=_e();const ve=U(ye),be=(t,e)=>{if(t.question.split("/").length>=5)return{text:"",invisibleCharacters:0};const i=Array.from(t.question);let g="",n=0,r=!1,c=0;for(const a of i)n>=e?(n++,c++):(g+=a,r?a==="】"&&(r=!1):a==="【"?r=!0:n++);return{text:g,invisibleCharacters:c}},M=(t,e)=>{if(t.question.split("/").length>=5){const a=t.question.split("/"),o=a.slice(0,e),d=a.slice(e),b=o.join(""),F=d.map((L,N)=>Array.from(L).map((B,O,J)=>N===d.length-1&&O===J.length-1&&["。","？","?"].includes(B)?B:"◯").join("​")).join("/");return`${b}​${F}`}const i=Array.from(t.question),g=i[i.length-1],{text:n,invisibleCharacters:r}=be(t,e),c=Array(r).fill("").map((a,o)=>o===r-1&&["。","？","?"].includes(g)?g:"◯").join("​");return`${n}​${c}`},xe=t=>{if(t.question.split("/").length>=5)return t.question.split("/").length;const e=t.question.replaceAll(/【.*?】/g,"");return Array.from(e).length},we={components:{ArrowDownIcon:re,ArrowUpIcon:se},props:{game:{type:Object,required:!0},progressType:{type:String,required:!0}},data(){return{progress:1,isAnswerPanelShown:!1}},computed:{...te("slackInfos",["getUser"]),questionText(){return M(this.game,this.progress)},maxProgress(){return xe(this.game)},formattedStartDate(){return h(this.game.startDate).format("YYYY年M月D日")},formattedStartTime(){return h(this.game.startDate).format("YYYY-MM-DD HH:mm:ss")},formattedRegistrationTime(){return h(this.game.registrationDate).format("YYYY-MM-DD HH:mm:ss")},formattedFinishTime(){return h(this.game.finishDate).format("YYYY-MM-DD HH:mm:ss")},formattedGenre(){return this.game.genre==="normal"?"正統派":this.game.genre==="strange"?"変化球":this.game.genre==="anything"?"なんでも":"不明"},timelineChunks(){const t=[...this.game.comments.map(i=>({...i,type:"comment"})),...this.game.correctAnswers.map(i=>({...i,type:"correctAnswer"})),...this.game.wrongAnswers.map(i=>({...i,type:"wrongAnswer"}))],e=ee(Object.entries(fe(t,i=>i.days)),([i])=>parseInt(i));for(const[,i]of e)i.sort((g,n)=>(g.date||0)-(n.date||0));return e}},watch:{progressType(t){if(t==="first"&&this.gotoProgress(1),t==="first-answer"){const e=ge(this.game.correctAnswers);this.gotoProgress(e?e.progress:1)}if(t==="last-answer"){const e=ve(this.game.correctAnswers);this.gotoProgress(e?e.progress:1)}t==="last"&&this.gotoProgress(this.maxProgress)}},methods:{incrementProgress(){this.progress<this.maxProgress&&this.progress++},decrementProgress(){this.progress>1&&this.progress--},gotoProgress(t){this.progress=t},getUserName(t){const e=this.getUser(t);return`@${f(e,["profile","display_name"],!1)||f(e,["real_name"],!1)||"匿名ユーザー"}`},getUserIcon(t){const e=this.getUser(t);return f(e,["profile","image_24"],"/images/anonymous-icon_24.png")},getUserIcon2x(t){const e=this.getUser(t);return f(e,["profile","image_48"],"/images/anonymous-icon_48.png")},formatTime(t){return h(t||0).format("HH:mm:ss")},getQuestionText(t){return M(this.game,t)}}},Ae={class:"SlowQuizGame box"},ke={class:"pagination",role:"navigation","aria-label":"pagination"},qe={class:"pagination-list"},Pe={key:0},Te={key:1},Ce={key:2},Ie={class:"pagination-link is-current"},Ue={key:3},Be={key:4},De={key:5},Ye={class:"is-size-3 has-text-weight-bold question-text"},ze={class:"has-text-grey has-text-right is-size-6"},Se={class:"correct-answers"},Qe=["src","srcset"],je=["onClick"],He={class:"card game-answer"},Re={type:"button",class:"card-header-icon"},Ve={class:"icon"},Ge={key:0,class:"card-content"},Me={class:"content"},Ee={class:"is-size-3 has-text-weight-bold question-text"},Fe={class:"is-size-3 has-text-weight-bold question-text"},Le={class:"has-text-success has-background-success-light"},Ne={class:"pt-1"},Oe={key:0},Je={class:"timeline"},Ke={class:"timeline-header-wrapper"},We={class:"timeline-header"},Xe={class:"tag is-primary"},Ze={class:"has-text-grey-light is-size-7"},$e={class:"timeline-marker is-warning is-image is-32x32"},es=["src","srcset"],ss={class:"timeline-content"},rs={class:"heading"},ts={key:0,class:"tag is-danger"};function ns(t,e,i,g,n,r){const c=D("arrow-up-icon"),a=D("arrow-down-icon");return l(),m("div",Ae,[s("nav",ke,[s("a",{class:_(["pagination-previous",{"is-disabled":n.progress===1}]),onClick:e[0]||(e[0]=(...o)=>r.decrementProgress&&r.decrementProgress(...o))}," 1文字減らす ",2),s("a",{class:_(["pagination-next",{"is-disabled":n.progress===r.maxProgress}]),onClick:e[1]||(e[1]=(...o)=>r.incrementProgress&&r.incrementProgress(...o))}," 1文字増やす ",2),s("ul",qe,[n.progress>=3?(l(),m("li",Pe,[s("a",{class:"pagination-link",onClick:e[2]||(e[2]=o=>r.gotoProgress(1))}," 1 ")])):p("",!0),n.progress>=4?(l(),m("li",Te,[...e[7]||(e[7]=[s("span",{class:"pagination-ellipsis"},"…",-1)])])):p("",!0),n.progress>=2?(l(),m("li",Ce,[s("a",{class:"pagination-link",onClick:e[3]||(e[3]=o=>r.gotoProgress(n.progress-1))},u(n.progress-1),1)])):p("",!0),s("li",null,[s("a",Ie,u(n.progress),1)]),n.progress<=r.maxProgress-1?(l(),m("li",Ue,[s("a",{class:"pagination-link",onClick:e[4]||(e[4]=o=>r.gotoProgress(n.progress+1))},u(n.progress+1),1)])):p("",!0),n.progress<=r.maxProgress-3?(l(),m("li",Be,[...e[8]||(e[8]=[s("span",{class:"pagination-ellipsis"},"…",-1)])])):p("",!0),n.progress<=r.maxProgress-2?(l(),m("li",De,[s("a",{class:"pagination-link",onClick:e[5]||(e[5]=o=>r.gotoProgress(r.maxProgress))},u(r.maxProgress),1)])):p("",!0)])]),s("h2",Ye,u(r.questionText),1),s("p",ze,u(r.getUserName(i.game.author))+" の問題 / "+u(r.formattedStartDate)+"出題 / ジャンル: "+u(r.formattedGenre),1),s("ol",Se,[(l(!0),m(y,null,v(i.game.correctAnswers,o=>(l(),m("li",{key:o.user},[s("img",{class:"answer-icon",src:r.getUserIcon(o.user),srcset:`${r.getUserIcon(o.user)} 1x, ${r.getUserIcon2x(o.user)} 2x`},null,8,Qe),Y(" "+u(r.getUserName(o.user))+" ("+u(o.progress)+"文字) ",1),s("a",{class:"button is-small",onClick:()=>r.gotoProgress(o.progress)}," ここまで表示 ",8,je)]))),128))]),s("div",He,[s("header",{class:"card-header",onClick:e[6]||(e[6]=o=>n.isAnswerPanelShown=!n.isAnswerPanelShown)},[e[9]||(e[9]=s("p",{class:"card-header-title"}," 正解を表示する ",-1)),s("button",Re,[s("span",Ve,[n.isAnswerPanelShown?(l(),I(c,{key:0})):(l(),I(a,{key:1}))])])]),n.isAnswerPanelShown?(l(),m("div",Ge,[s("div",Me,[s("div",Ee," Q. "+u(i.game.question),1),s("div",Fe,[e[10]||(e[10]=Y(" A. ",-1)),s("span",Le,u(i.game.answer),1)]),s("p",Ne,"読み: "+u(i.game.ruby),1),i.game.hint!==null?(l(),m("p",Oe,"ヒント: "+u(i.game.hint),1)):p("",!0),e[12]||(e[12]=s("hr",null,null,-1)),s("div",Je,[(l(!0),m(y,null,v(r.timelineChunks,o=>(l(),m("div",{key:o[0]},[s("div",Ke,[s("header",We,[s("span",Xe,u(o[0])+"日目",1)]),s("div",Ze,u(r.getQuestionText(o[1][0].progress)),1)]),(l(!0),m(y,null,v(o[1],d=>(l(),m("div",{key:d.date,class:"timeline-item"},[s("div",$e,[s("img",{src:r.getUserIcon(d.user),srcset:`${r.getUserIcon(d.user)} 1x, ${r.getUserIcon2x(d.user)} 2x`},null,8,es)]),s("div",ss,[s("p",rs,u(r.formatTime(d.date)),1),s("p",{class:_({"has-text-info":d.type==="comment"})},[s("span",{class:_({"has-text-weight-bold":d.type!=="comment"})},u(d.answer),3),d.type==="correctAnswer"?(l(),m("span",ts,"正解")):p("",!0)],2)])]))),128))]))),128)),e[11]||(e[11]=s("header",{class:"timeline-header"},[s("span",{class:"tag is-medium is-primary"},"回答終了")],-1))]),s("ul",null,[s("li",null,"問題登録: "+u(r.formattedRegistrationTime),1),s("li",null,"出題: "+u(r.formattedStartTime),1),s("li",null,"回答終了: "+u(r.formattedFinishTime),1)])])])):p("",!0)])])}const is=Object.assign(E(we,[["render",ns]]),{__name:"SlowQuizGame"}),os={data(){return{isLoading:!0,progressType:"none"}},async fetch({store:t}){},head(){return{title:"1日1文字クイズログ - achievement-viewer"}},computed:{...ne({games:t=>t.slowQuizGames.list})},mounted(){Promise.all([this.$store.dispatch("slowQuizGames/initList"),this.$store.dispatch("slackInfos/initUsers")]).then(()=>{this.isLoading=!1})}},as={class:"container is-max-desktop"},ls={key:0,class:"progress is-small is-primary",max:"100"},gs={class:"control is-flex"},us={class:"buttons are-small"};function cs(t,e,i,g,n,r){const c=W,a=is;return l(),m("div",as,[n.isLoading?(l(),m("progress",ls)):p("",!0),ie(c),e[5]||(e[5]=s("p",{class:"title"},"1日1文字クイズログ",-1)),s("div",gs,[e[4]||(e[4]=s("div",{class:"control-label"},"一括操作",-1)),s("div",us,[s("button",{type:"button",class:"button is-primary is-outlined",onClick:e[0]||(e[0]=o=>n.progressType="first")}," 1文字目のみ表示 "),s("button",{type:"button",class:"button is-primary is-outlined",onClick:e[1]||(e[1]=o=>n.progressType="first-answer")}," 最初の正解者まで表示 "),s("button",{type:"button",class:"button is-primary is-outlined",onClick:e[2]||(e[2]=o=>n.progressType="last-answer")}," 最後の正解者まで表示 "),s("button",{type:"button",class:"button is-primary is-outlined",onClick:e[3]||(e[3]=o=>n.progressType="last")}," 最後まで表示 ")])]),(l(!0),m(y,null,v(t.games,o=>(l(),I(a,{key:o.id,game:o,"progress-type":n.progressType},null,8,["game","progress-type"]))),128))])}const vs=E(os,[["render",cs]]);export{vs as default};
