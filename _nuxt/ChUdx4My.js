import{g as _,_ as B}from"./D3S3ibJg.js";import{_ as U}from"./D6zQPdZi.js";import{d as b}from"./DfAzwDaU.js";import{s as h}from"./C1hB4guA.js";import{_ as C,D as N,z as I,A as w,c as a,B as T,b as V,a as e,E as p,G as F,d as u,H as g,F as P,C as v,I as f,o as n,y as L,w as Q,t as d}from"./uCbs7Pzz.js";import"./Cpj98o6Y.js";import"./CdjJNdvM.js";const k=100,z={data(){return{isLoading:!0,sortBy:"timestamp",currentPage:1,searchQuery:""}},async fetch({store:t}){},head(){return{title:"sandboxのトピックログ - achievement-viewer"}},computed:{...w({topicMessages:t=>t.slackInfos.topicMessages.filter(({message:s})=>s?.reactions?.some(({name:l,count:c})=>l==="koresuki"&&c>=3))}),...I("slackInfos",["getUser"]),filteredTopics(){if(!this.searchQuery.trim())return this.topicMessages;const t=this.searchQuery.toLowerCase().normalize("NFKC");return this.topicMessages.filter(({message:s})=>{const l=(s.text?.toLowerCase()||"").normalize("NFKC"),c=this.getUserName(s).toLowerCase().normalize("NFKC");return l.includes(t)||c.includes(t)})},sortedTopics(){let t;return this.sortBy==="timestamp"?t=h(this.filteredTopics,({message:s})=>s.ts).reverse():this.sortBy==="username"?t=h(this.filteredTopics,[({message:s})=>this.getUserName(s),({message:s})=>-parseFloat(s.ts)]):this.sortBy==="likes"?t=h(this.filteredTopics,[({likes:s})=>-s.length,({message:s})=>-parseFloat(s.ts)]):this.sortBy==="random"?t=h(this.filteredTopics,[({randomSortKey:s})=>s]):t=this.filteredTopics,t},totalPages(){return Math.ceil(this.sortedTopics.length/k)},paginatedTopics(){const t=(this.currentPage-1)*k,s=t+k;return this.sortedTopics.slice(t,s)},paginationRange(){const t=[],s=this.totalPages,l=this.currentPage,c=2;for(let o=Math.max(2,l-c);o<=Math.min(s-1,l+c);o++)t.push(o);return l-c>2&&t.unshift("..."),l+c<s-1&&t.push("..."),t.unshift(1),s>1&&t.push(s),t}},watch:{sortBy(){this.currentPage=1},searchQuery(){this.currentPage=1}},mounted(){Promise.all([this.$store.dispatch("slackInfos/initUsers"),this.$store.dispatch("slackInfos/initTopicMessages")]).then(()=>{this.isLoading=!1})},methods:{changePage(t){t>=1&&t<=this.totalPages&&(this.currentPage=t,window.scrollTo({top:0,behavior:"smooth"}))},...N({likeTopicMessage:"slackInfos/likeTopicMessage",unlikeTopicMessage:"slackInfos/unlikeTopicMessage"}),toggleTopicMessageLike(t,s){s?this.unlikeTopicMessage({ts:t.ts}):this.likeTopicMessage({ts:t.ts})},getUserName(t){if(t.username)return t.username;if(t.user&&t.user.startsWith("U")){const s=this.getUser(t.user);return`@${_(s,["profile","display_name"],!1)||_(s,["real_name"],!1)||"匿名ユーザー"}`}return"@匿名ユーザー"},getUserIcon(t){if(t?.icons?.image_48)return t.icons.image_48;if(t.user&&t.user.startsWith("U")){const s=this.getUser(t.user);return _(s,["profile","image_24"],"/images/anonymous-icon_24.png")}return"/images/anonymous-icon_24.png"},getTime(t){const s=parseFloat(t);return b(s*1e3).format("YYYY/MM/DD")}}},A={class:"container is-max-desktop"},D={key:0,class:"progress is-small is-primary",max:"100"},E={class:"field"},Y={class:"control has-icons-left"},R={class:"control is-spaced"},G={class:"radio"},K={class:"radio"},S={class:"radio"},j={class:"radio"},q={class:"table-container"},W={class:"table topics"},H={class:"topic-text"},X=["src"],J={key:1,class:"topic-user"},O=["src"],Z={class:"topic-like"},$=["onClick"],ss={key:0,class:"ri-heart-fill"},ts={key:1,class:"ri-heart-line"},es={class:"topic-timestamp"},is={class:"topic-slacklog"},os=["href"],rs={key:1,class:"pagination is-centered",role:"navigation","aria-label":"pagination"},ns={class:"pagination-list"},as={key:0,class:"pagination-ellipsis"},ls=["aria-label","aria-current","onClick"];function cs(t,s,l,c,o,r){const x=B,M=U;return n(),a("div",A,[o.isLoading?(n(),a("progress",D)):T("",!0),V(x,{required:""}),s[14]||(s[14]=e("p",{class:"title"},"sandboxのトピックログ",-1)),e("div",E,[e("div",Y,[p(e("input",{"onUpdate:modelValue":s[0]||(s[0]=i=>o.searchQuery=i),class:"input",type:"text",placeholder:"トピックを検索..."},null,512),[[F,o.searchQuery]]),s[7]||(s[7]=e("span",{class:"icon is-left"},[e("i",{class:"ri-search-line"})],-1))])]),e("div",R,[s[12]||(s[12]=u(" 並び替え: ",-1)),e("label",G,[p(e("input",{id:"timestamp","onUpdate:modelValue":s[1]||(s[1]=i=>o.sortBy=i),type:"radio",value:"timestamp"},null,512),[[g,o.sortBy]]),s[8]||(s[8]=u(" 新しい順 ",-1))]),e("label",K,[p(e("input",{id:"username","onUpdate:modelValue":s[2]||(s[2]=i=>o.sortBy=i),type:"radio",value:"username"},null,512),[[g,o.sortBy]]),s[9]||(s[9]=u(" ユーザー順 ",-1))]),e("label",S,[p(e("input",{id:"likes","onUpdate:modelValue":s[3]||(s[3]=i=>o.sortBy=i),type:"radio",value:"likes"},null,512),[[g,o.sortBy]]),s[10]||(s[10]=u(" お気に入り順 ",-1))]),e("label",j,[p(e("input",{id:"random","onUpdate:modelValue":s[4]||(s[4]=i=>o.sortBy=i),type:"radio",value:"random"},null,512),[[g,o.sortBy]]),s[11]||(s[11]=u(" ランダム ",-1))])]),e("div",q,[e("table",W,[e("tbody",null,[(n(!0),a(P,null,v(r.paginatedTopics,({message:i,likes:m,isLiked:y})=>(n(),a("tr",{key:i.ts},[e("td",H,[i.user?(n(),L(M,{key:0,to:`/users/${i.user}`,class:"topic-user"},{default:Q(()=>[e("img",{class:"topic-icon",src:r.getUserIcon(i)},null,8,X),u(" "+d(r.getUserName(i)),1)]),_:2},1032,["to"])):(n(),a("span",J,[e("img",{class:"topic-icon",src:r.getUserIcon(i)},null,8,O),u(" "+d(r.getUserName(i)),1)])),e("strong",null,d(i.text),1)]),e("td",Z,[e("span",{class:"icon",onClick:()=>r.toggleTopicMessageLike(i,y)},[y?(n(),a("i",ss)):(n(),a("i",ts))],8,$),u(d(m.length),1)]),e("td",es,d(r.getTime(i.ts)),1),e("td",is,[e("a",{href:`https://slack-log.tsg.ne.jp/C7AAX50QY/${i.ts}`,target:"_blank",rel:"noopener noreferrer"},[...s[13]||(s[13]=[u(" slacklog",-1),e("span",{class:"icon"},[e("i",{class:"ri-external-link-line"})],-1)])],8,os)])]))),128))])])]),r.totalPages>1?(n(),a("nav",rs,[e("a",{class:f(["pagination-previous",{"is-disabled":o.currentPage===1}]),onClick:s[5]||(s[5]=i=>r.changePage(o.currentPage-1))}," 前へ ",2),e("a",{class:f(["pagination-next",{"is-disabled":o.currentPage===r.totalPages}]),onClick:s[6]||(s[6]=i=>r.changePage(o.currentPage+1))}," 次へ ",2),e("ul",ns,[(n(!0),a(P,null,v(r.paginationRange,(i,m)=>(n(),a("li",{key:m},[i==="..."?(n(),a("span",as,"…")):(n(),a("a",{key:1,class:f(["pagination-link",{"is-current":i===o.currentPage}]),"aria-label":`ページ ${i}`,"aria-current":i===o.currentPage?"page":null,onClick:()=>r.changePage(i)},d(i),11,ls))]))),128))])])):T("",!0)])}const fs=C(z,[["render",cs]]);export{fs as default};
