import{g as r,_ as w}from"./CHhSLU9n.js";import{_ as b}from"./DV2GOJhW.js";import{g as C,_ as I}from"./DhnMIEp9.js";import{_ as L,c,z as x,b as l,a as t,d as h,w as _,J as D,t as n,F as f,A as p,D as B,K as N,P as g,C as S,o as a,y as z,H as U}from"./CKrRpQ5q.js";import"./Cpj98o6Y.js";const M={data(){return{isLoading:!0,scaleToMaxUser:!1}},async fetch({store:e}){},head(){return{title:`実績「${this.title}」 - achievement-viewer`}},computed:{...S({userList:e=>e.users.list}),achievementDatum(){return this.$store.getters["achievementData/getById"]((this._.provides[g]||this.$route).params.id)},title(){return r(this.achievementDatum,["title"],"")},condition(){return r(this.achievementDatum,["condition"],"")},count(){return r(this.achievementDatum,["count"],0)},counter(){return r(this.achievementDatum,["counter"],null)},value(){return r(this.achievementDatum,["value"],0)},difficulty(){return r(this.achievementDatum,["difficulty"],"")},category(){return r(this.achievementDatum,["category"],"")},users(){return this.$store.getters["achievements/getByName"]((this._.provides[g]||this.$route).params.id).map(({name:s,date:u,user:y})=>({name:s,date:u,user:this.$store.getters["slackInfos/getUser"](y)})).sort((s,u)=>s.date-u.date).map(({user:s})=>s)},sortedUserList(){return this.userList.slice().sort((e,s)=>(s[this.counter]||0)-(e[this.counter]||0)).map(e=>({info:this.$store.getters["slackInfos/getUser"](e.id),count:e[this.counter],id:e.id}))},maxCount(){return Math.max(...this.sortedUserList.map(e=>e.count))},sameCounterAchievements(){return this.counter===null?[]:this.$store.getters["achievementData/getByCounter"](this.counter)},categoryColor(){return C(this.category)}},mounted(){Promise.all([this.$store.dispatch("achievementData/initList"),this.$store.dispatch("achievements/fetchByName",(this._.provides[g]||this.$route).params.id),this.$store.dispatch("slackInfos/initUsers"),this.$store.dispatch("users/initList")]).then(()=>{this.isLoading=!1})},methods:{getUserName(e){return`@${r(e,["profile","display_name"],!1)||r(e,["real_name"],!1)||"匿名ユーザー"}`},getUserIcon(e){return r(e,["profile","image_24"],"/images/anonymous-icon_24.png")},getUserIcon2x(e){return r(e,["profile","image_48"],"/images/anonymous-icon_48.png")},getUserIcon3x(e){return r(e,["profile","image_72"],"/images/anonymous-icon_72.png")}}},T={class:"container"},V={key:0,class:"progress is-small is-primary",max:"100"},A={class:"block"},P={class:"box"},F={class:"title is-size-1"},W={class:"subtitle"},$={class:"block"},E={class:"block"},H=["src"],J={key:1},K={class:"steps has-content-centered"},O={class:"steps-content"},R={class:"is-size-4"},j={class:"is-size-7"},q={class:"field"},G={class:"table-container"},Q={class:"table"},X={style:{whiteSpace:"nowrap",maxWidth:"15rem",textOverflow:"ellipsis",overflow:"hidden"}},Y=["src","srcset"],Z={style:{minWidth:"15rem"}},tt=["value","max"],et={style:{whiteSpace:"nowrap"}};function st(e,s,u,y,d,o){const k=w,m=b,v=I;return a(),c("div",T,[d.isLoading?(a(),c("progress",V,"15%")):x("",!0),l(k),t("div",A,[s[1]||(s[1]=h(" カテゴリ: ",-1)),l(m,{to:`/categories/${o.category}`,class:"category-tag tag is-medium",style:D({backgroundColor:o.categoryColor})},{default:_(()=>[h(n(o.category),1)]),_:1},8,["to","style"])]),t("div",P,[t("h1",F,[h(n(o.title),1),l(v,{difficulty:o.difficulty},null,8,["difficulty"])]),t("h2",W,n(o.condition),1)]),t("div",$,n(o.count)+"人が解除済み",1),t("div",E,[(a(!0),c(f,null,p(o.users,i=>(a(),z(m,{key:i.id,to:`/users/${i.id}`},{default:_(()=>[t("img",{src:o.getUserIcon3x(i)},null,8,H)]),_:2},1032,["to"]))),128))]),o.counter!==null?(a(),c("div",J,[s[5]||(s[5]=t("h1",{class:"title is-3"},"上位/下位実績",-1)),t("ul",K,[(a(!0),c(f,null,p(o.sameCounterAchievements,i=>(a(),c("li",{key:i.id,class:U(["steps-segment",{"is-active":i.id===(e._.provides[g]||e.$route).params.id}])},[l(m,{to:`/achievements/${i.id}`},{default:_(()=>[s[2]||(s[2]=t("span",{class:"steps-marker"},null,-1)),t("div",O,[t("p",R,n(i.title),1),t("p",j,n(i.condition),1),l(v,{difficulty:i.difficulty},null,8,["difficulty"])])]),_:2},1032,["to"])],2))),128))]),s[6]||(s[6]=t("h1",{class:"title is-3"},"実績の達成状況",-1)),t("div",q,[B(t("input",{id:"scaleSwitch","onUpdate:modelValue":s[0]||(s[0]=i=>d.scaleToMaxUser=i),type:"checkbox",name:"scaleSwitch",class:"switch"},null,512),[[N,d.scaleToMaxUser]]),s[3]||(s[3]=t("label",{for:"scaleSwitch"},"最大ユーザを基準にする",-1))]),t("div",G,[t("table",Q,[s[4]||(s[4]=t("thead",null,[t("tr",null,[t("th",null,"ユーザー"),t("th",{style:{width:"100%"}},"達成状況"),t("th")])],-1)),t("tbody",null,[(a(!0),c(f,null,p(o.sortedUserList,i=>(a(),c("tr",{key:i.id},[t("td",X,[l(m,{to:`/users/${i.id}`},{default:_(()=>[t("img",{class:"index-icon",src:o.getUserIcon(i.info),srcset:`${o.getUserIcon(i.info)} 1x, ${o.getUserIcon2x(i.info)} 2x`},null,8,Y),h(" "+n(o.getUserName(i.info)),1)]),_:2},1032,["to"])]),t("td",Z,[t("progress",{class:U(["progress is-success",(i.count||0)>=o.value?"is-success":"is-warning"]),value:i.count||0,max:d.scaleToMaxUser?o.maxCount:o.value},null,10,tt)]),t("td",et,n(i.count||0)+" / "+n(o.value),1)]))),128))])])])])):x("",!0)])}const ct=L(M,[["render",st]]);export{ct as default};
