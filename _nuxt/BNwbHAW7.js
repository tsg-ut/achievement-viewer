import{g as m,_ as v}from"./b6Z1bE-H.js";import{d as w}from"./DfAzwDaU.js";import{I as D,A as S,a as U}from"./BwhAHS5T.js";import{_ as C,c as o,o as n,a as s,I,z as q,x as y,t as r,F as h,C as x,B as u,d as k,b as P,J as L,y as b,A as T}from"./DdzqBwbR.js";import"./Cpj98o6Y.js";const z={name:"ios-close-icon",mixins:[D],data(){return{iconTitle:this.title?this.title:"Ios Close Icon"}}},Y=["data-title"],B=["width","height"];function H(e,t,i,g,l,c){return n(),o("div",{class:I(["ion",e.ionClass]),"data-title":l.iconTitle,"data-name":"ios-close-icon"},[(n(),o("svg",{width:e.w,height:e.h,class:"ion__svg",viewBox:"0 0 512 512"},[...t[0]||(t[0]=[s("path",{d:"M278.6 256l68.2-68.2c6.2-6.2 6.2-16.4 0-22.6-6.2-6.2-16.4-6.2-22.6 0L256 233.4l-68.2-68.2c-6.2-6.2-16.4-6.2-22.6 0-3.1 3.1-4.7 7.2-4.7 11.3 0 4.1 1.6 8.2 4.7 11.3l68.2 68.2-68.2 68.2c-3.1 3.1-4.7 7.2-4.7 11.3 0 4.1 1.6 8.2 4.7 11.3 6.2 6.2 16.4 6.2 22.6 0l68.2-68.2 68.2 68.2c6.2 6.2 16.4 6.2 22.6 0 6.2-6.2 6.2-16.4 0-22.6L278.6 256z"},null,-1)])],8,B))],10,Y)}const M=C(z,[["render",H]]),N={components:{ArrowDownIcon:U,ArrowUpIcon:S,CloseCircleIcon:M},props:{game:{type:Object,required:!0}},data(){return{expandedPlayers:new Set,isDetailsPanelShown:!1}},computed:{...q("slackInfos",["getUser"]),formattedStartDate(){return w(this.game.startedAt.toDate()).format("YYYY年M月D日 HH:mm")},formattedFinishDate(){return w(this.game.finishedAt.toDate()).format("YYYY年M月D日 HH:mm")},sortedPlayers(){return[...this.game.players].sort((e,t)=>e.score!==null&&t.score!==null?e.score-t.score:e.score!==null?-1:t.score!==null?1:t.questionCount-e.questionCount)}},methods:{getUserName(e){const t=this.getUser(e);return`@${m(t,["profile","display_name"],!1)||m(t,["real_name"],!1)||"匿名ユーザー"}`},getUserIcon(e){const t=this.getUser(e);return m(t,["profile","image_24"],"/images/anonymous-icon_24.png")},getUserIcon2x(e){const t=this.getUser(e);return m(t,["profile","image_48"],"/images/anonymous-icon_48.png")},formatTime(e){return w(e).format("HH:mm:ss")},togglePlayerLog(e){this.expandedPlayers.has(e)?this.expandedPlayers.delete(e):this.expandedPlayers.add(e),this.expandedPlayers=new Set(this.expandedPlayers)},getRank(e){return this.sortedPlayers.filter(i=>i.score!==null).findIndex(i=>i.userId===e.userId)+1},getLastAnswer(e){if(!e.questions||e.questions.length===0)return"";const t=e.questions.filter(l=>l.isAnswerAttempt);return t.length===0?"":(t[t.length-1].question||"").replace(/^答え:\s*/,"")},getAnswerTagStyle(e){return{はい:{backgroundColor:"#48c774",color:"#fff"},いいえ:{backgroundColor:"#f14668",color:"#fff"},どちらかと言えばはい:{backgroundColor:"#a3e5b6",color:"#000"},どちらかと言えばいいえ:{backgroundColor:"#f9a7b8",color:"#000"},どちらともいえない:{backgroundColor:"#ffe08a",color:"#000"},わかりません:{backgroundColor:"#3e8ed0",color:"#fff"},答えられません:{backgroundColor:"#363636",color:"#fff"},"正解！":{backgroundColor:"#00aa17",color:"#fff"},不正解:{backgroundColor:"#ca0000",color:"#fff"}}[e]||{backgroundColor:"#f5f5f5",color:"#000"}}}},Q=["id"],G={class:"is-size-3 has-text-weight-bold"},F=["href"],R={class:"has-text-grey has-text-right is-size-6"},V={class:"players-section"},j={class:"is-size-5 has-text-weight-semibold mb-3"},O={class:"table-container"},E={class:"table is-fullwidth is-striped players-table"},J={key:0,class:"tag is-primary"},K={key:1,class:"tag is-light"},W=["src","srcset"],X={key:0,class:"tag is-success"},Z={key:1},$={key:0,class:"last-answer"},ss={key:2,class:"tag is-light not-answered"},es=["onClick"],ts={key:0},ns={colspan:"5",class:"player-log-cell"},os={class:"player-log"},as={class:"questions-list"},rs={key:0},is={key:1},cs={class:"question-time"},ls={class:"question-text"},ds={class:"question-answer"},us={class:"card game-details mt-4"},_s={type:"button",class:"card-header-icon"},ms={class:"icon"},hs={key:0,class:"card-content"},gs={class:"content"},fs={class:"is-size-5 has-text-weight-semibold"},ps={class:"topic-description"};function ws(e,t,i,g,l,c){const f=y("close-circle-icon"),p=y("arrow-up-icon"),_=y("arrow-down-icon");return n(),o("div",{id:i.game.id,class:"TwentyQuestionsGame box"},[s("h2",G,[s("a",{href:`#${i.game.id}`},"お題: "+r(i.game.topic)+" ("+r(i.game.topicRuby)+")",9,F)]),s("p",R,r(c.formattedStartDate)+"開始 / "+r(c.formattedFinishDate)+"終了 ",1),s("div",V,[s("h3",j," 参加者 ("+r(i.game.players.length)+"人) ",1),s("div",O,[s("table",E,[t[3]||(t[3]=s("thead",null,[s("tr",null,[s("th",null,"順位"),s("th",null,"プレイヤー"),s("th",null,"質問数"),s("th",null,"結果"),s("th",null,"操作")])],-1)),s("tbody",null,[(n(!0),o(h,null,x(c.sortedPlayers,a=>(n(),o(h,{key:a.userId},[s("tr",null,[s("td",null,[a.score!==null?(n(),o("span",J,r(c.getRank(a))+"位 ",1)):(n(),o("span",K,"-"))]),s("td",null,[s("img",{class:"player-icon",src:c.getUserIcon(a.userId),srcset:`${c.getUserIcon(a.userId)} 1x, ${c.getUserIcon2x(a.userId)} 2x`},null,8,W),k(" "+r(c.getUserName(a.userId)),1)]),s("td",null,r(a.questionCount)+"問",1),s("td",null,[a.score!==null?(n(),o("span",X," 正解 ("+r(a.score)+"問) ",1)):a.questionCount>0?(n(),o("span",Z,[t[1]||(t[1]=s("span",{class:"tag is-danger"},"不正解",-1)),c.getLastAnswer(a)?(n(),o("span",$,[P(f,{class:"last-answer-icon",w:"20",h:"20"}),k(" "+r(c.getLastAnswer(a)),1)])):u("",!0)])):(n(),o("span",ss," 未参加 "))]),s("td",null,[a.questionCount>0?(n(),o("button",{key:0,type:"button",class:"button is-small",onClick:()=>c.togglePlayerLog(a.userId)},r(l.expandedPlayers.has(a.userId)?"履歴を隠す":"履歴を表示"),9,es)):u("",!0)])]),l.expandedPlayers.has(a.userId)&&a.questionCount>0?(n(),o("tr",ts,[s("td",ns,[s("div",os,[s("div",as,[(n(!0),o(h,null,x(a.questions,(d,A)=>(n(),o("div",{key:A,class:"question-item"},[s("span",{class:I(["question-label",{"has-text-success":d.isAnswerAttempt&&d.isCorrect,"has-text-danger":d.isAnswerAttempt&&!d.isCorrect,"has-text-info":!d.isAnswerAttempt}])},[d.isAnswerAttempt?(n(),o("span",is,"A")):(n(),o("span",rs,"Q"+r(A+1),1))],2),s("span",cs,r(c.formatTime(d.timestamp)),1),s("span",ls,r(d.question),1),s("span",ds,[t[2]||(t[2]=k(" → ",-1)),s("span",{class:"tag answer-tag",style:L(c.getAnswerTagStyle(d.answer))},r(d.answer),5)])]))),128))])])])])):u("",!0)],64))),128))])])])]),s("div",us,[s("header",{class:"card-header",onClick:t[0]||(t[0]=a=>l.isDetailsPanelShown=!l.isDetailsPanelShown)},[t[4]||(t[4]=s("p",{class:"card-header-title"}," データシートを表示 ",-1)),s("button",_s,[s("span",ms,[l.isDetailsPanelShown?(n(),b(p,{key:0})):(n(),b(_,{key:1}))])])]),l.isDetailsPanelShown?(n(),o("div",hs,[s("div",gs,[s("h4",fs,r(i.game.topic)+" ("+r(i.game.topicRuby)+")",1),s("pre",ps,r(i.game.topicDescription),1)])])):u("",!0)])],8,Q)}const ys=Object.assign(C(N,[["render",ws],["__scopeId","data-v-1faed9b1"]]),{__name:"TwentyQuestionsGame"}),ks={data(){return{isLoading:!0}},async fetch({store:e}){},head(){return{title:"20の扉ログ - achievement-viewer"}},computed:{...T({games:e=>e.twentyQuestionsGames.list})},mounted(){Promise.all([this.$store.dispatch("twentyQuestionsGames/initList"),this.$store.dispatch("slackInfos/initUsers")]).then(()=>{this.isLoading=!1})}},xs={class:"container is-max-desktop"},bs={key:0,class:"progress is-small is-primary",max:"100"};function Cs(e,t,i,g,l,c){const f=v,p=ys;return n(),o("div",xs,[l.isLoading?(n(),o("progress",bs)):u("",!0),P(f),t[0]||(t[0]=s("p",{class:"title"},"20の扉ログ",-1)),(n(!0),o(h,null,x(e.games,_=>(n(),b(p,{key:_.id,game:_},null,8,["game"]))),128))])}const Ss=C(ks,[["render",Cs]]);export{Ss as default};
