import{g as u,_ as P}from"./Cd5IUpCk.js";import{d as f}from"./DfAzwDaU.js";import{A as I,a as A}from"./Ct85-MD2.js";import{z as D,_ as b,x as k,c as a,o as n,a as e,t as r,F as _,C as p,B as m,d as x,I as v,J as S,y,A as U,b as z}from"./DzNLpZrd.js";import"./Cpj98o6Y.js";const Y={components:{ArrowDownIcon:A,ArrowUpIcon:I},props:{game:{type:Object,required:!0}},data(){return{expandedPlayers:new Set,isDetailsPanelShown:!1}},computed:{...D("slackInfos",["getUser"]),formattedStartDate(){return f(this.game.startedAt.toDate()).format("YYYY年M月D日 HH:mm")},formattedFinishDate(){return f(this.game.finishedAt.toDate()).format("YYYY年M月D日 HH:mm")},sortedPlayers(){return[...this.game.players].sort((s,t)=>s.score!==null&&t.score!==null?s.score-t.score:s.score!==null?-1:t.score!==null?1:t.questionCount-s.questionCount)}},methods:{getUserName(s){const t=this.getUser(s);return`@${u(t,["profile","display_name"],!1)||u(t,["real_name"],!1)||"匿名ユーザー"}`},getUserIcon(s){const t=this.getUser(s);return u(t,["profile","image_24"],"/images/anonymous-icon_24.png")},getUserIcon2x(s){const t=this.getUser(s);return u(t,["profile","image_48"],"/images/anonymous-icon_48.png")},formatTime(s){return f(s).format("HH:mm:ss")},togglePlayerLog(s){this.expandedPlayers.has(s)?this.expandedPlayers.delete(s):this.expandedPlayers.add(s),this.expandedPlayers=new Set(this.expandedPlayers)},getRank(s){return this.sortedPlayers.filter(i=>i.score!==null).findIndex(i=>i.userId===s.userId)+1},getAnswerTagStyle(s){return{はい:{backgroundColor:"#48c774",color:"#fff"},いいえ:{backgroundColor:"#f14668",color:"#fff"},どちらかと言えばはい:{backgroundColor:"#a3e5b6",color:"#000"},どちらかと言えばいいえ:{backgroundColor:"#f9a7b8",color:"#000"},どちらともいえない:{backgroundColor:"#ffe08a",color:"#000"},わかりません:{backgroundColor:"#3e8ed0",color:"#fff"},答えられません:{backgroundColor:"#363636",color:"#fff"},"正解！":{backgroundColor:"#00aa17",color:"#fff"},不正解:{backgroundColor:"#ca0000",color:"#fff"}}[s]||{backgroundColor:"#f5f5f5",color:"#000"}}}},L=["id"],T={class:"is-size-3 has-text-weight-bold"},q=["href"],H={class:"has-text-grey has-text-right is-size-6"},N={class:"players-section"},Q={class:"is-size-5 has-text-weight-semibold mb-3"},B={class:"table-container"},G={class:"table is-fullwidth is-striped"},F={key:0,class:"tag is-primary"},M={key:1,class:"tag is-light"},R=["src","srcset"],V={key:0,class:"tag is-success"},j={key:1,class:"tag is-danger"},O={key:2,class:"tag is-light not-answered"},E=["onClick"],J={key:0},K={colspan:"5",class:"player-log-cell"},W={class:"player-log"},X={class:"questions-list"},Z={key:0},$={key:1},ee={class:"question-time"},se={class:"question-text"},te={class:"question-answer"},oe={class:"card game-details mt-4"},ne={type:"button",class:"card-header-icon"},ae={class:"icon"},re={key:0,class:"card-content"},ie={class:"content"},ce={class:"is-size-5 has-text-weight-semibold"},le={class:"topic-description"};function de(s,t,i,C,d,c){const h=k("arrow-up-icon"),g=k("arrow-down-icon");return n(),a("div",{id:i.game.id,class:"TwentyQuestionsGame box"},[e("h2",T,[e("a",{href:`#${i.game.id}`},"お題: "+r(i.game.topic)+" ("+r(i.game.topicRuby)+")",9,q)]),e("p",H,r(c.formattedStartDate)+"開始 / "+r(c.formattedFinishDate)+"終了 ",1),e("div",N,[e("h3",Q," 参加者 ("+r(i.game.players.length)+"人) ",1),e("div",B,[e("table",G,[t[2]||(t[2]=e("thead",null,[e("tr",null,[e("th",null,"順位"),e("th",null,"プレイヤー"),e("th",null,"質問数"),e("th",null,"結果"),e("th",null,"操作")])],-1)),e("tbody",null,[(n(!0),a(_,null,p(c.sortedPlayers,o=>(n(),a(_,{key:o.userId},[e("tr",null,[e("td",null,[o.score!==null?(n(),a("span",F,r(c.getRank(o))+"位 ",1)):(n(),a("span",M,"-"))]),e("td",null,[e("img",{class:"player-icon",src:c.getUserIcon(o.userId),srcset:`${c.getUserIcon(o.userId)} 1x, ${c.getUserIcon2x(o.userId)} 2x`},null,8,R),x(" "+r(c.getUserName(o.userId)),1)]),e("td",null,r(o.questionCount)+"問",1),e("td",null,[o.score!==null?(n(),a("span",V," 正解 ("+r(o.score)+"問) ",1)):o.questionCount>0?(n(),a("span",j," 不正解 ")):(n(),a("span",O," 未参加 "))]),e("td",null,[o.questionCount>0?(n(),a("button",{key:0,type:"button",class:"button is-small",onClick:()=>c.togglePlayerLog(o.userId)},r(d.expandedPlayers.has(o.userId)?"履歴を隠す":"履歴を表示"),9,E)):m("",!0)])]),d.expandedPlayers.has(o.userId)&&o.questionCount>0?(n(),a("tr",J,[e("td",K,[e("div",W,[e("div",X,[(n(!0),a(_,null,p(o.questions,(l,w)=>(n(),a("div",{key:w,class:"question-item"},[e("span",{class:v(["question-label",{"has-text-success":l.isAnswerAttempt&&l.isCorrect,"has-text-danger":l.isAnswerAttempt&&!l.isCorrect,"has-text-info":!l.isAnswerAttempt}])},[l.isAnswerAttempt?(n(),a("span",$,"A")):(n(),a("span",Z,"Q"+r(w+1),1))],2),e("span",ee,r(c.formatTime(l.timestamp)),1),e("span",se,r(l.question),1),e("span",te,[t[1]||(t[1]=x(" → ",-1)),e("span",{class:"tag answer-tag",style:S(c.getAnswerTagStyle(l.answer))},r(l.answer),5)])]))),128))])])])])):m("",!0)],64))),128))])])])]),e("div",oe,[e("header",{class:"card-header",onClick:t[0]||(t[0]=o=>d.isDetailsPanelShown=!d.isDetailsPanelShown)},[t[3]||(t[3]=e("p",{class:"card-header-title"}," データシートを表示 ",-1)),e("button",ne,[e("span",ae,[d.isDetailsPanelShown?(n(),y(h,{key:0})):(n(),y(g,{key:1}))])])]),d.isDetailsPanelShown?(n(),a("div",re,[e("div",ie,[e("h4",ce,r(i.game.topic)+" ("+r(i.game.topicRuby)+")",1),e("pre",le,r(i.game.topicDescription),1)])])):m("",!0)])],8,L)}const ue=Object.assign(b(Y,[["render",de],["__scopeId","data-v-f51a2638"]]),{__name:"TwentyQuestionsGame"}),_e={data(){return{isLoading:!0}},async fetch({store:s}){},head(){return{title:"20の扉ログ - achievement-viewer"}},computed:{...U({games:s=>s.twentyQuestionsGames.list})},mounted(){Promise.all([this.$store.dispatch("twentyQuestionsGames/initList"),this.$store.dispatch("slackInfos/initUsers")]).then(()=>{this.isLoading=!1})}},me={class:"container is-max-desktop"},he={key:0,class:"progress is-small is-primary",max:"100"};function ge(s,t,i,C,d,c){const h=P,g=ue;return n(),a("div",me,[d.isLoading?(n(),a("progress",he)):m("",!0),z(h),t[0]||(t[0]=e("p",{class:"title"},"20の扉ログ",-1)),(n(!0),a(_,null,p(s.games,o=>(n(),y(g,{key:o.id,game:o},null,8,["game"]))),128))])}const xe=b(_e,[["render",ge]]);export{xe as default};
