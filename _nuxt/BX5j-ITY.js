import{g as y,_ as x}from"./CQ-HwNBC.js";import{_ as v}from"./CvEU9OJv.js";import{d as B}from"./DfAzwDaU.js";import{s as _}from"./jSHzBlNm.js";import{_ as C,z as M,A as N,c as r,B as c,b as I,a as e,d as u,E as h,H as f,F as g,C as k,o,y as O,w as V,t as l}from"./Dbu0joaF.js";import"./Cpj98o6Y.js";import"./CdjJNdvM.js";const z={data(){return{isLoading:!0,sortBy:"timestamp",openedMessages:[]}},async fetch({store:t}){},head(){return{title:"夢占いログ - achievement-viewer"}},computed:{...N({oneiromancyMessages:t=>t.oneiromancies.oneiromancyMessages,oneiromancyCriteria:t=>t.oneiromancies.oneiromancyCriteria,isUnauthorized:t=>t.slackInfos.isUnauthorized}),...M("slackInfos",["getUser"]),sortedOneiromancies(){return this.sortBy==="timestamp"?_(this.oneiromancyMessages,({message:t})=>t.ts).reverse():this.sortBy==="username"?_(this.oneiromancyMessages,[({message:t})=>this.getUserName(t),({message:t})=>-parseFloat(t.ts)]):this.sortBy==="points"?_(this.oneiromancyMessages,[({summary:t})=>-(t.point??-1/0),({message:t})=>-parseFloat(t.ts)]):this.oneiromancyMessages},filteredOneiromancyCriteria(){return this.oneiromancyCriteria.filter(t=>t.name!=="基準点")}},mounted(){Promise.all([this.$store.dispatch("slackInfos/initUsers"),this.$store.dispatch("oneiromancies/initOneiromancyMessages"),this.$store.dispatch("oneiromancies/initOneiromancyCriteria")]).then(()=>{this.isLoading=!1})},methods:{getUserName(t){if(t.username)return t.username;if(t.user&&t.user.startsWith("U")){const s=this.getUser(t.user);return`@${y(s,["profile","display_name"],!1)||y(s,["real_name"],!1)||"匿名ユーザー"}`}return"@匿名ユーザー"},getUserIcon(t){if(t?.icons?.image_48)return t.icons.image_48;if(t.user&&t.user.startsWith("U")){const s=this.getUser(t.user);return y(s,["profile","image_24"],"/images/anonymous-icon_24.png")}return"/images/anonymous-icon_24.png"},getTime(t){const s=parseFloat(t);return B(s*1e3).format("YYYY/MM/DD")},toggleOpenedMessage(t){this.openedMessages.includes(t)?this.openedMessages=this.openedMessages.filter(s=>s!==t):this.openedMessages.push(t)},formatSlackText(t){return(t??"").trim().split(`
`).slice(2).join(`
`)}}},F={class:"container is-max-desktop"},Y={key:0,class:"progress is-small is-primary",max:"100"},w={class:"control is-spaced"},A={class:"radio"},T={class:"radio"},j={class:"radio"},D={key:1,class:"table-container"},L={class:"table is-striped is-hoverable oneiromancies"},S=["onClick"],E={class:"oneiromancy-username"},Q={key:0},W=["src"],X={key:2},q=["src"],G={class:"oneiromancy-lucky-item"},H={class:"oneiromancy-point"},P={class:"oneiromancy-timestamp"},R={class:"oneiromancy-slacklog"},J=["href"],K={key:0,class:"oneiromancy-detail"},Z={colspan:5},$={class:"oneiromancy-original-text"},ee={class:"oneiromancy-text"},te={key:2,class:"table-container"},se={class:"table is-hoverable is-fullwidth"},ne=["href"];function oe(t,s,m,re,a,i){const U=x,b=v;return o(),r("div",F,[a.isLoading?(o(),r("progress",Y)):c("",!0),I(U,{required:""}),s[13]||(s[13]=e("p",{class:"title"},"夢占いログ",-1)),e("div",w,[s[6]||(s[6]=u(" 並び替え: ",-1)),e("label",A,[h(e("input",{id:"timestamp","onUpdate:modelValue":s[0]||(s[0]=n=>a.sortBy=n),type:"radio",value:"timestamp"},null,512),[[f,a.sortBy]]),s[3]||(s[3]=u(" 新しい順 ",-1))]),e("label",T,[h(e("input",{id:"username","onUpdate:modelValue":s[1]||(s[1]=n=>a.sortBy=n),type:"radio",value:"username"},null,512),[[f,a.sortBy]]),s[4]||(s[4]=u(" ユーザー順 ",-1))]),e("label",j,[h(e("input",{id:"points","onUpdate:modelValue":s[2]||(s[2]=n=>a.sortBy=n),type:"radio",value:"points"},null,512),[[f,a.sortBy]]),s[5]||(s[5]=u(" 点数順 ",-1))])]),t.isUnauthorized?c("",!0):(o(),r("div",D,[e("table",L,[s[10]||(s[10]=e("tbody",null,[e("tr",null,[e("th",null,"ユーザー"),e("th",null,"ラッキーアイテム"),e("th",null,"点数"),e("th",null,"日時"),e("th",null,"リンク")])],-1)),(o(!0),r(g,null,k(i.sortedOneiromancies,({message:n,summary:p,originalMessage:d})=>(o(),r("tbody",{key:n.ts},[e("tr",{class:"oneiromancy",onClick:()=>i.toggleOpenedMessage(n.ts)},[e("td",E,[d?d?.user!==void 0?(o(),O(b,{key:1,to:`/users/${d?.user}`},{default:V(()=>[e("img",{class:"oneiromancy-icon",src:i.getUserIcon(d)},null,8,W),u(" "+l(i.getUserName(d)),1)]),_:2},1032,["to"])):(o(),r("span",X,[e("img",{class:"oneiromancy-icon",src:i.getUserIcon(d)},null,8,q),u(" "+l(i.getUserName(d)),1)])):(o(),r("span",Q," - "))]),e("td",G,[e("strong",null,l(p.luckyItem??"-"),1)]),e("td",H,[e("strong",null,l(Number.isFinite(p.point)?`${p.point}点`:"-"),1)]),e("td",P,l(i.getTime(n.ts)),1),e("td",R,[e("a",{href:`https://slack-log.tsg.ne.jp/C7AAX50QY/${n.ts}`,target:"_blank",rel:"noopener noreferrer"},[...s[7]||(s[7]=[u(" slacklog",-1),e("span",{class:"icon"},[e("i",{class:"ri-external-link-line"})],-1)])],8,J)])],8,S),a.openedMessages.includes(n.ts)?(o(),r("tr",K,[e("td",Z,[s[8]||(s[8]=e("h3",null,"元メッセージ",-1)),e("div",$,l(d?.text?.trim()),1),s[9]||(s[9]=e("h3",null,"夢占い",-1)),e("div",ee,l(i.formatSlackText(n.text)),1)])])):c("",!0)]))),128))])])),s[14]||(s[14]=e("p",{class:"title"},"採点基準一覧",-1)),t.isUnauthorized?c("",!0):(o(),r("div",te,[e("table",se,[e("tbody",null,[s[12]||(s[12]=e("tr",null,[e("th",null,"名前"),e("th",null,"点数"),e("th",null,"リンク")],-1)),(o(!0),r(g,null,k(i.filteredOneiromancyCriteria,n=>(o(),r("tr",{key:n.name},[e("td",null,[e("strong",null,l(n.name),1)]),e("td",null,l(n.point)+"点",1),e("td",null,[e("a",{href:`https://slack-log.tsg.ne.jp/C7AAX50QY/${n.ts}`,target:"_blank",rel:"noopener noreferrer"},[...s[11]||(s[11]=[u(" slacklog",-1),e("span",{class:"icon"},[e("i",{class:"ri-external-link-line"})],-1)])],8,ne)])]))),128))])])]))])}const pe=C(z,[["render",oe]]);export{pe as default};
