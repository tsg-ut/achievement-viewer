import{g as o,_ as b}from"./BB-raGk9.js";import{_ as C}from"./C_5VWG77.js";import{g as I,_ as w}from"./LuKg8N2S.js";import{_ as B,A as L,c,B as v,b as l,a as t,d as m,w as h,H as N,t as n,F as g,C as f,P as _,o as a,y as D,I as x}from"./OCyp5rLu.js";import"./Cpj98o6Y.js";const z={data(){return{isLoading:!0}},async fetch({store:e}){},head(){return{title:`実績「${this.title}」 - achievement-viewer`}},computed:{...L({userList:e=>e.users.list}),achievementDatum(){return this.$store.getters["achievementData/getById"]((this._.provides[_]||this.$route).params.id)},title(){return o(this.achievementDatum,["title"],"")},condition(){return o(this.achievementDatum,["condition"],"")},count(){return o(this.achievementDatum,["count"],0)},counter(){return o(this.achievementDatum,["counter"],null)},value(){return o(this.achievementDatum,["value"],0)},difficulty(){return o(this.achievementDatum,["difficulty"],"")},category(){return o(this.achievementDatum,["category"],"")},users(){return this.$store.getters["achievements/getByName"]((this._.provides[_]||this.$route).params.id).map(({name:i,date:u,user:y})=>({name:i,date:u,user:this.$store.getters["slackInfos/getUser"](y)})).sort((i,u)=>i.date-u.date).map(({user:i})=>i)},sortedUserList(){return this.userList.slice().sort((e,i)=>(i[this.counter]||0)-(e[this.counter]||0)).map(e=>({info:this.$store.getters["slackInfos/getUser"](e.id),count:e[this.counter],id:e.id}))},sameCounterAchievements(){return this.counter===null?[]:this.$store.getters["achievementData/getByCounter"](this.counter)},categoryColor(){return I(this.category)}},mounted(){Promise.all([this.$store.dispatch("achievementData/initList"),this.$store.dispatch("achievements/fetchByName",(this._.provides[_]||this.$route).params.id),this.$store.dispatch("slackInfos/initUsers"),this.$store.dispatch("users/initList")]).then(()=>{this.isLoading=!1})},methods:{getUserName(e){return`@${o(e,["profile","display_name"],!1)||o(e,["real_name"],!1)||"匿名ユーザー"}`},getUserIcon(e){return o(e,["profile","image_24"],"/images/anonymous-icon_24.png")},getUserIcon2x(e){return o(e,["profile","image_48"],"/images/anonymous-icon_48.png")},getUserIcon3x(e){return o(e,["profile","image_72"],"/images/anonymous-icon_72.png")}}},S={class:"container"},$={key:0,class:"progress is-small is-primary",max:"100"},V={class:"block"},A={class:"box"},P={class:"title is-size-1"},F={class:"subtitle"},W={class:"block"},E={class:"block"},H=["src"],O={key:1},R={class:"steps has-content-centered"},T={class:"steps-content"},j={class:"is-size-4"},q={class:"is-size-7"},G={class:"table-container"},J={class:"table"},K={style:{whiteSpace:"nowrap",maxWidth:"15rem",textOverflow:"ellipsis",overflow:"hidden"}},M=["src","srcset"],Q={style:{minWidth:"15rem"}},X=["value","max"],Y={style:{whiteSpace:"nowrap"}};function Z(e,i,u,y,k,r){const U=b,d=C,p=w;return a(),c("div",S,[k.isLoading?(a(),c("progress",$,"15%")):v("",!0),l(U),t("div",V,[i[0]||(i[0]=m(" カテゴリ: ",-1)),l(d,{to:`/categories/${r.category}`,class:"category-tag tag is-medium",style:N({backgroundColor:r.categoryColor})},{default:h(()=>[m(n(r.category),1)]),_:1},8,["to","style"])]),t("div",A,[t("h1",P,[m(n(r.title),1),l(p,{difficulty:r.difficulty},null,8,["difficulty"])]),t("h2",F,n(r.condition),1)]),t("div",W,n(r.count)+"人が解除済み",1),t("div",E,[(a(!0),c(g,null,f(r.users,s=>(a(),D(d,{key:s.id,to:`/users/${s.id}`},{default:h(()=>[t("img",{src:r.getUserIcon3x(s)},null,8,H)]),_:2},1032,["to"]))),128))]),r.counter!==null?(a(),c("div",O,[i[3]||(i[3]=t("h1",{class:"title is-3"},"上位/下位実績",-1)),t("ul",R,[(a(!0),c(g,null,f(r.sameCounterAchievements,s=>(a(),c("li",{key:s.id,class:x(["steps-segment",{"is-active":s.id===(e._.provides[_]||e.$route).params.id}])},[l(d,{to:`/achievements/${s.id}`},{default:h(()=>[i[1]||(i[1]=t("span",{class:"steps-marker"},null,-1)),t("div",T,[t("p",j,n(s.title),1),t("p",q,n(s.condition),1),l(p,{difficulty:s.difficulty},null,8,["difficulty"])])]),_:2},1032,["to"])],2))),128))]),i[4]||(i[4]=t("h1",{class:"title is-3"},"実績の達成状況",-1)),t("div",G,[t("table",J,[i[2]||(i[2]=t("thead",null,[t("tr",null,[t("th",null,"ユーザー"),t("th",{style:{width:"100%"}},"達成状況"),t("th")])],-1)),t("tbody",null,[(a(!0),c(g,null,f(r.sortedUserList,s=>(a(),c("tr",{key:s.id},[t("td",K,[l(d,{to:`/users/${s.id}`},{default:h(()=>[t("img",{class:"index-icon",src:r.getUserIcon(s.info),srcset:`${r.getUserIcon(s.info)} 1x, ${r.getUserIcon2x(s.info)} 2x`},null,8,M),m(" "+n(r.getUserName(s.info)),1)]),_:2},1032,["to"])]),t("td",Q,[t("progress",{class:x(["progress is-success",(s.count||0)>=r.value?"is-success":"is-warning"]),value:s.count||0,max:r.value},null,10,X)]),t("td",Y,n(s.count||0)+" / "+n(r.value),1)]))),128))])])])])):v("",!0)])}const ot=B(z,[["render",Z]]);export{ot as default};
