import{g as y,_ as B}from"./C0VE3x8l.js";import{_ as C}from"./B1q6798D.js";import{d as N,s as _}from"./Df4BwJnZ.js";import{_ as I,v as O,m as g,c as i,n as m,b as V,a as t,d as u,x as h,y as f,F as U,q as v,o as r,s as F,w as Y,t as a}from"./DzcFNF6r.js";import"./C4iS2aBk.js";import"./CwXImgea.js";const w={data(){return{isLoading:!0,sortBy:"timestamp",openedMessages:[]}},async fetch({store:e}){},head(){return{title:"夢占いログ - achievement-viewer"}},computed:{...g({oneiromancyMessages:e=>e.oneiromancies.oneiromancyMessages,oneiromancyCriteria:e=>e.oneiromancies.oneiromancyCriteria,isUnauthorized:e=>e.slackInfos.isUnauthorized}),...O("slackInfos",["getUser"]),sortedOneiromancies(){return this.sortBy==="timestamp"?_(this.oneiromancyMessages,({message:e})=>e.ts).reverse():this.sortBy==="username"?_(this.oneiromancyMessages,[({message:e})=>this.getUserName(e),({message:e})=>-parseFloat(e.ts)]):this.sortBy==="points"?_(this.oneiromancyMessages,[({summary:e})=>-(e.point??-1/0),({message:e})=>-parseFloat(e.ts)]):this.oneiromancyMessages},filteredOneiromancyCriteria(){return this.oneiromancyCriteria.filter(e=>e.name!=="基準点")}},mounted(){Promise.all([this.$store.dispatch("slackInfos/initUsers"),this.$store.dispatch("oneiromancies/initOneiromancyMessages"),this.$store.dispatch("oneiromancies/initOneiromancyCriteria")]).then(()=>{this.isLoading=!1})},methods:{getUserName(e){if(e.username)return e.username;if(e.user&&e.user.startsWith("U")){const s=this.getUser(e.user);return`@${y(s,["profile","display_name"],!1)||y(s,["real_name"],!1)||"匿名ユーザー"}`}return"@匿名ユーザー"},getUserIcon(e){var s;if((s=e==null?void 0:e.icons)!=null&&s.image_48)return e.icons.image_48;if(e.user&&e.user.startsWith("U")){const c=this.getUser(e.user);return y(c,["profile","image_24"],"/images/anonymous-icon_24.png")}return"/images/anonymous-icon_24.png"},getTime(e){const s=parseFloat(e);return N(s*1e3).format("YYYY/MM/DD")},toggleOpenedMessage(e){this.openedMessages.includes(e)?this.openedMessages=this.openedMessages.filter(s=>s!==e):this.openedMessages.push(e)},formatSlackText(e){return(e??"").trim().split(`
`).slice(2).join(`
`)}}},z={class:"container is-max-desktop"},T={key:0,class:"progress is-small is-primary",max:"100"},j={class:"control is-spaced"},A={class:"radio"},D={class:"radio"},L={class:"radio"},S={key:1,class:"table-container"},q={class:"table is-striped is-hoverable oneiromancies"},Q=["onClick"],W={class:"oneiromancy-username"},X={key:0},E=["src"],G={key:2},P=["src"],R={class:"oneiromancy-lucky-item"},H={class:"oneiromancy-point"},J={class:"oneiromancy-timestamp"},K={class:"oneiromancy-slacklog"},Z=["href"],M={key:0,class:"oneiromancy-detail"},$={colspan:5},tt={class:"oneiromancy-original-text"},et={class:"oneiromancy-text"},st={key:2,class:"table-container"},nt={class:"table is-hoverable is-fullwidth"},ot=["href"];function rt(e,s,c,it,d,l){const x=B,b=C;return r(),i("div",z,[d.isLoading?(r(),i("progress",T)):m("",!0),V(x,{required:""}),s[13]||(s[13]=t("p",{class:"title"},"夢占いログ",-1)),t("div",j,[s[6]||(s[6]=u(" 並び替え: ",-1)),t("label",A,[h(t("input",{type:"radio",id:"timestamp",value:"timestamp","onUpdate:modelValue":s[0]||(s[0]=n=>d.sortBy=n)},null,512),[[f,d.sortBy]]),s[3]||(s[3]=u(" 新しい順 ",-1))]),t("label",D,[h(t("input",{type:"radio",id:"username",value:"username","onUpdate:modelValue":s[1]||(s[1]=n=>d.sortBy=n)},null,512),[[f,d.sortBy]]),s[4]||(s[4]=u(" ユーザー順 ",-1))]),t("label",L,[h(t("input",{type:"radio",id:"points",value:"points","onUpdate:modelValue":s[2]||(s[2]=n=>d.sortBy=n)},null,512),[[f,d.sortBy]]),s[5]||(s[5]=u(" 点数順 ",-1))])]),e.isUnauthorized?m("",!0):(r(),i("div",S,[t("table",q,[s[10]||(s[10]=t("tbody",null,[t("tr",null,[t("th",null,"ユーザー"),t("th",null,"ラッキーアイテム"),t("th",null,"点数"),t("th",null,"日時"),t("th",null,"リンク")])],-1)),(r(!0),i(U,null,v(l.sortedOneiromancies,({message:n,summary:p,originalMessage:o})=>{var k;return r(),i("tbody",{key:n.ts},[t("tr",{onClick:lt=>l.toggleOpenedMessage(n.ts),class:"oneiromancy"},[t("td",W,[o?(o==null?void 0:o.user)!==void 0?(r(),F(b,{key:1,to:`/users/${o==null?void 0:o.user}`},{default:Y(()=>[t("img",{class:"oneiromancy-icon",src:l.getUserIcon(o)},null,8,E),u(" "+a(l.getUserName(o)),1)]),_:2},1032,["to"])):(r(),i("span",G,[t("img",{class:"oneiromancy-icon",src:l.getUserIcon(o)},null,8,P),u(" "+a(l.getUserName(o)),1)])):(r(),i("span",X," - "))]),t("td",R,[t("strong",null,a(p.luckyItem??"-"),1)]),t("td",H,[t("strong",null,a(Number.isFinite(p.point)?`${p.point}点`:"-"),1)]),t("td",J,a(l.getTime(n.ts)),1),t("td",K,[t("a",{href:"https://slack-log.tsg.ne.jp/C7AAX50QY/"+n.ts,target:"_blank",rel:"noopener nereferrer"},[...s[7]||(s[7]=[u(" slacklog",-1),t("span",{class:"icon"},[t("i",{class:"ri-external-link-line"})],-1)])],8,Z)])],8,Q),d.openedMessages.includes(n.ts)?(r(),i("tr",M,[t("td",$,[s[8]||(s[8]=t("h3",null,"元メッセージ",-1)),t("div",tt,a((k=o==null?void 0:o.text)==null?void 0:k.trim()),1),s[9]||(s[9]=t("h3",null,"夢占い",-1)),t("div",et,a(l.formatSlackText(n.text)),1)])])):m("",!0)])}),128))])])),s[14]||(s[14]=t("p",{class:"title"},"採点基準一覧",-1)),e.isUnauthorized?m("",!0):(r(),i("div",st,[t("table",nt,[t("tbody",null,[s[12]||(s[12]=t("tr",null,[t("th",null,"名前"),t("th",null,"点数"),t("th",null,"リンク")],-1)),(r(!0),i(U,null,v(l.filteredOneiromancyCriteria,n=>(r(),i("tr",{key:n.name},[t("td",null,[t("strong",null,a(n.name),1)]),t("td",null,a(n.point)+"点",1),t("td",null,[t("a",{href:"https://slack-log.tsg.ne.jp/C7AAX50QY/"+n.ts,target:"_blank",rel:"noopener nereferrer"},[...s[11]||(s[11]=[u(" slacklog",-1),t("span",{class:"icon"},[t("i",{class:"ri-external-link-line"})],-1)])],8,ot)])]))),128))])])]))])}const yt=I(w,[["render",rt]]);export{yt as default};
