import{g as m,_ as M}from"./C0VE3x8l.js";import{_ as B}from"./B1q6798D.js";import{d as U,s as d}from"./Df4BwJnZ.js";import{_ as x,A as v,v as T,m as b,c,n as I,b as N,a as e,d as r,x as u,y as _,F as V,q as C,o as n,s as F,w as L,t as p}from"./DzcFNF6r.js";import"./C4iS2aBk.js";import"./CwXImgea.js";const Y={data(){return{isLoading:!0,sortBy:"timestamp"}},async fetch({store:t}){},head(){return{title:"sandboxのトピックログ - achievement-viewer"}},computed:{...b({topicMessages:t=>t.slackInfos.topicMessages.filter(({message:s})=>{var a;return(a=s==null?void 0:s.reactions)==null?void 0:a.some(({name:f,count:i})=>f==="koresuki"&&i>=3)})}),...T("slackInfos",["getUser"]),sortedTopics(){return this.sortBy==="timestamp"?d(this.topicMessages,({message:t})=>t.ts).reverse():this.sortBy==="username"?d(this.topicMessages,[({message:t})=>this.getUserName(t),({message:t})=>-parseFloat(t.ts)]):this.sortBy==="likes"?d(this.topicMessages,[({likes:t})=>-t.length,({message:t})=>-parseFloat(t.ts)]):this.sortBy==="random"?d(this.topicMessages,[({randomSortKey:t})=>t]):this.topicMessages}},mounted(){Promise.all([this.$store.dispatch("slackInfos/initUsers"),this.$store.dispatch("slackInfos/initTopicMessages")]).then(()=>{this.isLoading=!1})},methods:{...v({likeTopicMessage:"slackInfos/likeTopicMessage",unlikeTopicMessage:"slackInfos/unlikeTopicMessage"}),toggleTopicMessageLike(t,s){s?this.unlikeTopicMessage({ts:t.ts}):this.likeTopicMessage({ts:t.ts})},getUserName(t){if(t.username)return t.username;if(t.user&&t.user.startsWith("U")){const s=this.getUser(t.user);return`@${m(s,["profile","display_name"],!1)||m(s,["real_name"],!1)||"匿名ユーザー"}`}return"@匿名ユーザー"},getUserIcon(t){var s;if((s=t==null?void 0:t.icons)!=null&&s.image_48)return t.icons.image_48;if(t.user&&t.user.startsWith("U")){const a=this.getUser(t.user);return m(a,["profile","image_24"],"/images/anonymous-icon_24.png")}return"/images/anonymous-icon_24.png"},getTime(t){const s=parseFloat(t);return U(s*1e3).format("YYYY/MM/DD")}}},w={class:"container is-max-desktop"},A={key:0,class:"progress is-small is-primary",max:"100"},D={class:"control is-spaced"},j={class:"radio"},q={class:"radio"},S={class:"radio"},W={class:"radio"},z={class:"table-container"},E={class:"table topics"},G={class:"topic-text"},P=["src"],Q={key:1},R=["src"],X={class:"topic-like"},H=["onClick"],J={key:0,class:"ri-heart-fill"},K={key:1,class:"ri-heart-line"},O={class:"topic-timestamp"},Z={class:"topic-slacklog"},$=["href"];function ss(t,s,a,f,i,l){const h=M,y=B;return n(),c("div",w,[i.isLoading?(n(),c("progress",A)):I("",!0),N(h,{required:""}),s[10]||(s[10]=e("p",{class:"title"},"sandboxのトピックログ",-1)),e("div",D,[s[8]||(s[8]=r(" 並び替え: ",-1)),e("label",j,[u(e("input",{type:"radio",id:"timestamp",value:"timestamp","onUpdate:modelValue":s[0]||(s[0]=o=>i.sortBy=o)},null,512),[[_,i.sortBy]]),s[4]||(s[4]=r(" 新しい順 ",-1))]),e("label",q,[u(e("input",{type:"radio",id:"username",value:"username","onUpdate:modelValue":s[1]||(s[1]=o=>i.sortBy=o)},null,512),[[_,i.sortBy]]),s[5]||(s[5]=r(" ユーザー順 ",-1))]),e("label",S,[u(e("input",{type:"radio",id:"likes",value:"likes","onUpdate:modelValue":s[2]||(s[2]=o=>i.sortBy=o)},null,512),[[_,i.sortBy]]),s[6]||(s[6]=r(" お気に入り順 ",-1))]),e("label",W,[u(e("input",{type:"radio",id:"random",value:"random","onUpdate:modelValue":s[3]||(s[3]=o=>i.sortBy=o)},null,512),[[_,i.sortBy]]),s[7]||(s[7]=r(" ランダム ",-1))])]),e("div",z,[e("table",E,[e("tbody",null,[(n(!0),c(V,null,C(l.sortedTopics,({message:o,likes:g,isLiked:k})=>(n(),c("tr",{key:o.ts},[e("td",G,[o.user?(n(),F(y,{key:0,to:`/users/${o.user}`},{default:L(()=>[e("img",{class:"topic-icon",src:l.getUserIcon(o)},null,8,P),r(" "+p(l.getUserName(o)),1)]),_:2},1032,["to"])):(n(),c("span",Q,[e("img",{class:"topic-icon",src:l.getUserIcon(o)},null,8,R),r(" "+p(l.getUserName(o)),1)])),e("strong",null,p(o.text),1)]),e("td",X,[e("span",{class:"icon",onClick:ts=>l.toggleTopicMessageLike(o,k)},[k?(n(),c("i",J)):(n(),c("i",K))],8,H),r(p(g.length),1)]),e("td",O,p(l.getTime(o.ts)),1),e("td",Z,[e("a",{href:"https://slack-log.tsg.ne.jp/C7AAX50QY/"+o.ts,target:"_blank",rel:"noopener nereferrer"},[...s[9]||(s[9]=[r(" slacklog",-1),e("span",{class:"icon"},[e("i",{class:"ri-external-link-line"})],-1)])],8,$)])]))),128))])])])])}const ls=x(Y,[["render",ss]]);export{ls as default};
