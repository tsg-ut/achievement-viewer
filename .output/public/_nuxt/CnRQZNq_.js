import{g as _,_ as M}from"./DuHpimfN.js";import{_ as B}from"./B8ROhAl_.js";import{d as U,s as d}from"./Cxlwj5oH.js";import{_ as x,k as v,m as T,g as b,c as l,j as I,b as N,a as e,d as r,l as u,v as m,F as V,r as C,o as n,n as F,w as L,t as c}from"./hH7lbOeL.js";import"./DsqdWQfm.js";import"./CdjJNdvM.js";const Y={data(){return{isLoading:!0,sortBy:"timestamp"}},async fetch({store:t}){},head(){return{title:"sandboxのトピックログ - achievement-viewer"}},computed:{...b({topicMessages:t=>t.slackInfos.topicMessages.filter(({message:s})=>s?.reactions?.some(({name:p,count:g})=>p==="koresuki"&&g>=3))}),...T("slackInfos",["getUser"]),sortedTopics(){return this.sortBy==="timestamp"?d(this.topicMessages,({message:t})=>t.ts).reverse():this.sortBy==="username"?d(this.topicMessages,[({message:t})=>this.getUserName(t),({message:t})=>-parseFloat(t.ts)]):this.sortBy==="likes"?d(this.topicMessages,[({likes:t})=>-t.length,({message:t})=>-parseFloat(t.ts)]):this.sortBy==="random"?d(this.topicMessages,[({randomSortKey:t})=>t]):this.topicMessages}},mounted(){Promise.all([this.$store.dispatch("slackInfos/initUsers"),this.$store.dispatch("slackInfos/initTopicMessages")]).then(()=>{this.isLoading=!1})},methods:{...v({likeTopicMessage:"slackInfos/likeTopicMessage",unlikeTopicMessage:"slackInfos/unlikeTopicMessage"}),toggleTopicMessageLike(t,s){s?this.unlikeTopicMessage({ts:t.ts}):this.likeTopicMessage({ts:t.ts})},getUserName(t){if(t.username)return t.username;if(t.user&&t.user.startsWith("U")){const s=this.getUser(t.user);return`@${_(s,["profile","display_name"],!1)||_(s,["real_name"],!1)||"匿名ユーザー"}`}return"@匿名ユーザー"},getUserIcon(t){if(t?.icons?.image_48)return t.icons.image_48;if(t.user&&t.user.startsWith("U")){const s=this.getUser(t.user);return _(s,["profile","image_24"],"/images/anonymous-icon_24.png")}return"/images/anonymous-icon_24.png"},getTime(t){const s=parseFloat(t);return U(s*1e3).format("YYYY/MM/DD")}}},w={class:"container is-max-desktop"},D={key:0,class:"progress is-small is-primary",max:"100"},j={class:"control is-spaced"},A={class:"radio"},S={class:"radio"},W={class:"radio"},q={class:"radio"},z={class:"table-container"},E={class:"table topics"},G={class:"topic-text"},P=["src"],Q={key:1},R=["src"],X={class:"topic-like"},H=["onClick"],J={key:0,class:"ri-heart-fill"},K={key:1,class:"ri-heart-line"},O={class:"topic-timestamp"},Z={class:"topic-slacklog"},$=["href"];function ss(t,s,p,g,i,a){const k=M,h=B;return n(),l("div",w,[i.isLoading?(n(),l("progress",D)):I("",!0),N(k,{required:""}),s[10]||(s[10]=e("p",{class:"title"},"sandboxのトピックログ",-1)),e("div",j,[s[8]||(s[8]=r(" 並び替え: ",-1)),e("label",A,[u(e("input",{type:"radio",id:"timestamp",value:"timestamp","onUpdate:modelValue":s[0]||(s[0]=o=>i.sortBy=o)},null,512),[[m,i.sortBy]]),s[4]||(s[4]=r(" 新しい順 ",-1))]),e("label",S,[u(e("input",{type:"radio",id:"username",value:"username","onUpdate:modelValue":s[1]||(s[1]=o=>i.sortBy=o)},null,512),[[m,i.sortBy]]),s[5]||(s[5]=r(" ユーザー順 ",-1))]),e("label",W,[u(e("input",{type:"radio",id:"likes",value:"likes","onUpdate:modelValue":s[2]||(s[2]=o=>i.sortBy=o)},null,512),[[m,i.sortBy]]),s[6]||(s[6]=r(" お気に入り順 ",-1))]),e("label",q,[u(e("input",{type:"radio",id:"random",value:"random","onUpdate:modelValue":s[3]||(s[3]=o=>i.sortBy=o)},null,512),[[m,i.sortBy]]),s[7]||(s[7]=r(" ランダム ",-1))])]),e("div",z,[e("table",E,[e("tbody",null,[(n(!0),l(V,null,C(a.sortedTopics,({message:o,likes:y,isLiked:f})=>(n(),l("tr",{key:o.ts},[e("td",G,[o.user?(n(),F(h,{key:0,to:`/users/${o.user}`},{default:L(()=>[e("img",{class:"topic-icon",src:a.getUserIcon(o)},null,8,P),r(" "+c(a.getUserName(o)),1)]),_:2},1032,["to"])):(n(),l("span",Q,[e("img",{class:"topic-icon",src:a.getUserIcon(o)},null,8,R),r(" "+c(a.getUserName(o)),1)])),e("strong",null,c(o.text),1)]),e("td",X,[e("span",{class:"icon",onClick:ts=>a.toggleTopicMessageLike(o,f)},[f?(n(),l("i",J)):(n(),l("i",K))],8,H),r(c(y.length),1)]),e("td",O,c(a.getTime(o.ts)),1),e("td",Z,[e("a",{href:"https://slack-log.tsg.ne.jp/C7AAX50QY/"+o.ts,target:"_blank",rel:"noopener nereferrer"},[...s[9]||(s[9]=[r(" slacklog",-1),e("span",{class:"icon"},[e("i",{class:"ri-external-link-line"})],-1)])],8,$)])]))),128))])])])])}const ls=x(Y,[["render",ss]]);export{ls as default};
